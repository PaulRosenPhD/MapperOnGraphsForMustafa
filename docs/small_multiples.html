<!doctype html>
<html lang="en">
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">

    <!-- Icon -->
    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Mapper on Graphs</title>

    <script src="https://d3js.org/d3.v4.min.js"
            integrity="sha384-1EOYqz4UgZkewWm70NbT1JBUXSQpOIS2AaJy6/evZH+lXOrt9ITSJbFctNeyBoIJ"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"
            integrity="sha384-hX5odjoulJel81+3dsnorXlZ7kA46f8qrV+2sBCcEAXaCyEAiRusFRjaefWw2NPp"
            crossorigin="anonymous"></script>

    <script src="js/menu.js"></script>
    <script src="js/graph.js"></script>
    <script src="js/common.js"></script>
    <script src="js/input.js"></script>

</head>
<body>

<script>
	insert_navbar("small_multiples.html");
    insert_page_header();
</script>




<div class="page">
    <div class="sidebar">
        <form id="parameterForm">
            <div class="container" style="padding: 0;">
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="dataset" style="margin-top: 3px;">Data Set</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="dataset" name="dataset"
                                onchange="change_dataset();"></select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="datafile" style="margin-top: 3px;">Data File</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="datafile" name="datafile"
                                onchange="change_datafile();"></select>
                    </div>
                </div>

                <div class="d-inline-block align-middle" style="text-align: center;">
                <script>
                    let rank_cg = generate_checkbox('rank_filter','Histogram Equalization','load_mog()', 200)
                    document.write(rank_cg.getHTML())
                </script>
                </div>

                Component Method
                <div class="d-inline-block align-middle" style="text-align: center;">
                <script>
                    let component_rg = generate_radiogroup('component_method',
                                            [{value:'connected_components',label:'Connected Components',checked:true},
                                             {value:'modularity',label:'Modularity'},
                                             {value:'async_label_prop',label:'Async Label Propagation'}],
                                            'load_mog()', 200)
                    document.write(component_rg.getHTML())
                </script>
                </div>

                Connectivity Method
                <div class="d-inline-block align-middle" style="text-align: center;">
                <script>
                    let link_rg = generate_radiogroup('link_method',[{value:'connectivity',label:'Connectivity',checked:true}],'load_mog()', 200)
                    document.write(link_rg.getHTML())
                </script>
                </div>
            </div>


        </form>

        <!-- img src="static/img/viridis.png" width="100%" height="20" -->
    </div>

<script>
    let covers = [2,3,4,6,8,10,20]
    function generateFilterFunctionSVG( ff ){
        html = ''
        covers.forEach( cover => {
            html += '<svg height="200" width="200" style="border-style: solid; ' +
                    'border-width: 1px;" id="mog_vis_' + ff + '_' + cover + '"></svg>'
        })
        document.write(html)
    }
</script>

    <div class="page-content" id="visualization" style="white-space: nowrap;">
        <div style="text-align: left; width: 1200px;">
            <div id="mog_row_agd">
                <p class="row_title" id="row1_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/GnBu.png">
                    Average Geodesic Distance
                </p>
                <script>generateFilterFunctionSVG('agd')</script>
            </div>
            <div id="mog_row_den_0_5">
                <p class="row_title" id="row2_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/Oranges.png">
                    Density (0.5)
                </p>
                <script>generateFilterFunctionSVG('den_0_5')</script>
            </div>
            <div id="mog_row_ecc">
                <p class="row_title" id="row3_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/BuGn.png">
                    Eccentricity
                </p>
                <script>generateFilterFunctionSVG('ecc')</script>
            </div>
            <div id="mog_row_fv">
                <p class="row_title" id="row4_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/BuPu.png">
                    Fiedler Vector
                </p>
                <script>generateFilterFunctionSVG('fv')</script>
            </div>
            <div id="mog_row_fv_norm">
                <p class="row_title" id="row5_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/BuPu.png">
                    Fiedler Vector Normalized
                </p>
                <script>generateFilterFunctionSVG('fv_norm')</script>
            </div>
            <div id="mog_row_pr_0_85">
                <p class="row_title" id="row6_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/YlOrRd.png">
                    PageRank (alpha=0.85)
                </p>
                <script>generateFilterFunctionSVG('pr_0_85')</script>
            </div>
        </div>
    </div>
</div>


<script>





    let mogs = [];


    let MOG_Vis = function( svg_name, options, static_uri=true ){
        let param_uri = $.param(options)
        let mog_data = null
        let mog_vis = null
        let uri = 'mog?' + param_uri
        let ff = options.filter_func

        if( static_uri ){
            let ds = options.dataset
            let df = options.datafile
            df = df.substring(0,df.length-5)
            let covN = options.coverN
            let link_m = options.link_method
            let rank = ( options.rank_filter ) ? 'true' : 'false'
            let comp_m = options.component_method
            let overlap = options.coverOverlap

            uri = 'data/' + ds + '/' + df + '/' + ff + '_' + comp_m
                    + '_' + covN + '_' + overlap + '_' + link_m + '_' + rank + '.json'
        }

        function send_to_cache(){
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "update_mog?"+param_uri, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            tmp_data = {'info':mog_data.info,'nodes':mog_data.nodes,'links':[]};
            mog_data.links.forEach( function(L){
               tmp_data.links.push({'value':L.value,'source':L.source.id,'target':L.target.id});
            });
            xhr.send(JSON.stringify(tmp_data));
        }

        d3.json(uri, function (error, data) {
            if (error) {
                console.log(error);
            } else {
                mog_data = data
                mog_vis = FDL_Graph_Vis(svg_name, mog_data);
                mog_vis.set_node_radius(d => Math.min( Math.sqrt(d.comp_len), 20));
                mog_vis.set_node_color(n=>colorSchemes[ff](n.avg_v));
                mog_vis.set_link_width(d => Math.min( Math.sqrt(d.value), 20)/2 );
                mog_vis.add_count_labels();
                mog_vis.set_end_callback( ()=>{ mog_vis.zoomFit(); send_to_cache() } );
                mog_vis.load()
            }
        });

        return {
            remove : function(){
                if( mog_vis ) mog_vis.remove();
            }
        }

    }


    function change_dataset() {
        update_datafiles();
        change_datafile();
    }

    function load_mog(){

        mogs.forEach( M=>M.remove() );
        mogs = []

        let ds = get_selected_dataset();
        let df = get_selected_datafile();

        let possible_ff = ['agd','den_0_5','ecc','fv', 'fv_norm','pr_0_85']
        possible_ff.forEach( ff=>{
            document.getElementById("mog_row_"+ff).style.display = "none"
        })

        ff = []
        if( 'agd' in datasets[ds][df]) ff.push('agd')
        if( 'den_0_5' in datasets[ds][df]) ff.push('den_0_5')
        if( 'ecc' in datasets[ds][df]) ff.push('ecc')
        if( 'fv' in datasets[ds][df]) ff.push('fv')
        else if( 'fv_norm' in datasets[ds][df]) ff.push('fv_norm')
        if( 'pr_0_85' in datasets[ds][df]) ff.push('pr_0_85')

        ff.forEach( cur_ff => {

            document.getElementById("mog_row_"+cur_ff).style.display = "block"

            covers.forEach( coverN => {
                let options = {
                    'dataset': ds,
                    'datafile': df,
                    'filter_func': cur_ff,
                    'coverN': coverN,
                    'rank_filter':  rank_cg.isChecked(),
                    'coverOverlap': 0,
                    'component_method': component_rg.getSelected(),
                    'link_method': link_rg.getSelected()
                }
                mogs.push( MOG_Vis( "#mog_vis_"+cur_ff+"_"+coverN, options ) )
            })
        })

    }

    function change_datafile() {
        load_mog();
    }

    load_datasets(change_datafile);

</script>

<div id="overlay" onclick="overlay_off()"></div>

<script>
    function overlay_on() {
        document.getElementById("overlay").style.display = "block";
    }

    function overlay_off() {
        document.getElementById("overlay").style.display = "none";
    }
</script>

</body>
</html>

