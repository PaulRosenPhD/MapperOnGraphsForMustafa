<!doctype html>
<html lang="en">
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">

    <!-- Icon -->
    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Mapper on Graphs</title>

    <script src="https://d3js.org/d3.v4.min.js"
            integrity="sha384-1EOYqz4UgZkewWm70NbT1JBUXSQpOIS2AaJy6/evZH+lXOrt9ITSJbFctNeyBoIJ"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"
            integrity="sha384-hX5odjoulJel81+3dsnorXlZ7kA46f8qrV+2sBCcEAXaCyEAiRusFRjaefWw2NPp"
            crossorigin="anonymous"></script>

    <script src="js/GraphVisualization.js"></script>
    <script src="js/common.js"></script>
    <script src="js/input.js"></script>
    <script src="js/graph_loader.js"></script>

</head>
<body>

<script>
	insert_navbar("small_multiples.html");
    insert_page_header();
</script>




<div class="page">
    <div class="sidebar">
        <form id="parameterForm">
            <div class="container" style="padding: 0;">
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="dataset" style="margin-top: 3px;">Data Set</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="dataset" name="dataset"
                                onchange="change_dataset();"></select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="datafile" style="margin-top: 3px;">Data File</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="datafile" name="datafile"
                                onchange="change_datafile();"></select>
                    </div>
                </div>

                <div class="d-inline-block align-middle" style="text-align: center;">
                <script>
                    let rank_cg = generate_checkbox('rank_filter','Histogram Equalization','load_mog()', 200)
                    document.write(rank_cg.getHTML())
                </script>
                </div>

                Component Method
                <div class="d-inline-block align-middle" style="text-align: center;">
                <script>
                    let component_rg = generate_radiogroup('component_method',
                                            [{value:'connected_components',label:'Connected Components',checked:true},
                                             {value:'modularity',label:'Modularity'},
                                             {value:'async_label_prop',label:'Async Label Propagation'}],
                                            'load_mog()', 200)
                    document.write(component_rg.getHTML())
                </script>
                </div>

                Connectivity Method
                <div class="d-inline-block align-middle" style="text-align: center;">
                <script>
                    let link_rg = generate_radiogroup('link_method',[{value:'connectivity',label:'Connectivity',checked:true}],'load_mog()', 200)
                    document.write(link_rg.getHTML())
                </script>
                </div>
                <div class="form-group">
                    <script>
                        let draw_size_slider = generate_slider('Node/Edge Size: ', 'draw_size', 0.1, 5, 0.1, 5, 'change_draw_size()')
                        document.write(draw_size_slider.getHTML())
                    </script>
                </div>
            </div>


        </form>

    </div>


<script>
    let covers = [2,3,4,6,8,10,20]
    function generateFilterFunctionSVGs( title, ff, ff_img ){
        html = '<div id="mog_row_'+ff+'">' +
                    '<p class="row_title" id="row_title_'+ff+'">' +
                        '<img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="'+ff_img+'"/>' +
                        title +
                    '</p>'

        covers.forEach( cover => {
            html += '<svg height="200" width="200" style="border-style: solid; ' +
                    'border-width: 1px;" id="mog_vis_' + ff + '_' + cover + '"></svg>'
        })
        html += '</div>'
        document.write(html)
    }
</script>


    <div class="page-content" id="visualization" style="white-space: nowrap;">
        <div style="text-align: left; width: 1200px;">
                <script>
                    generateFilterFunctionSVGs('Average Geodesic Distance','agd', "img/GnBu.png")
                    generateFilterFunctionSVGs('Density (0.5)', 'den_0_5', "img/Oranges.png")
                    generateFilterFunctionSVGs('Eccentricity','ecc', "img/BuGn.png")
                    generateFilterFunctionSVGs('Fiedler Vector','fv', "img/BuPu.png")
                    generateFilterFunctionSVGs('Fiedler Vector (Normalized)','fv_norm',"img/BuPu.png")
                    generateFilterFunctionSVGs('PageRank (alpha=0.85)','pr_0_85',"img/YlOrRd.png")
                </script>
            </div>
        </div>
    </div>
</div>


<script>


    let mogs = [];

    function load_mog(){

        mogs.forEach( M=>M.remove() );
        mogs = []

        let possible_ff = ['agd','den_0_5','ecc','fv', 'fv_norm','pr_0_85']
        possible_ff.forEach( ff=>{
            document.getElementById("mog_row_"+ff).style.display = "none"
        })

        let ds = get_selected_dataset();
        let df = get_selected_datafile();

        let ff = Object.keys(datasets[ds][df]).sort()

        ff.forEach( cur_ff => {

            document.getElementById("mog_row_"+cur_ff).style.display = "block"

            covers.forEach( coverN => {
                let options = {
                    'dataset': ds,
                    'datafile': df,
                    'filter_func': cur_ff,
                    'coverN': coverN,
                    'rank_filter':  rank_cg.isChecked(),
                    'coverOverlap': 0,
                    'component_method': component_rg.getSelected(),
                    'link_method': link_rg.getSelected()
                }
                mogs.push( Load_MOG_Vis( "#mog_vis_"+cur_ff+"_"+coverN, options ) )
            })
        })

    }

    function change_dataset() {
        update_datafiles();
        change_datafile();
    }

    function change_datafile() {
        load_mog();
    }

    function change_draw_size(){
        mogs.forEach( m => {
            if( m.get_graph() ){
                m.get_graph().set_node_radius(d => Math.min( Math.sqrt(d.comp_len), 20) * draw_size_slider.getValue() / 5 );
                m.get_graph().set_link_width(d => Math.min( Math.sqrt(d.value), 20)/2 * draw_size_slider.getValue() / 5 );
            }
        })
    }

    load_datasets(change_datafile);

</script>

</body>
</html>

